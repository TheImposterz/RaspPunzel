<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RaspPunzel - Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #f5f7fa;
            color: #2d3748;
        }

        .header {
            background: white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-top {
            padding: 0 24px;
            border-bottom: 1px solid #e2e8f0;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 64px;
        }

        .header-left h1 {
            font-size: 20px;
            font-weight: 600;
            color: #667eea;
        }

        .user-menu { position: relative; }

        .user-button {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            cursor: pointer;
        }

        .user-button:hover { background: #edf2f7; }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 14px;
        }

        .dropdown-menu {
            position: absolute;
            right: 0;
            top: calc(100% + 8px);
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            min-width: 200px;
            display: none;
        }

        .dropdown-menu.show { display: block; }

        .dropdown-item {
            display: block;
            padding: 12px 16px;
            color: #2d3748;
            cursor: pointer;
        }

        .dropdown-item:hover { background: #f7fafc; }
        .dropdown-item.danger { color: #e53e3e; }

        .nav-tabs {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            gap: 4px;
            padding: 0 24px;
        }

        .nav-tab {
            padding: 16px 24px;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            color: #718096;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-tab:hover {
            color: #2d3748;
            background: #f7fafc;
        }

        .nav-tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 24px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .stat-label {
            font-size: 13px;
            color: #718096;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: #2d3748;
        }

        .stat-value.online { color: #38a169; }
        .stat-value.offline { color: #e53e3e; }
        .stat-value.warning { color: #ed8936; }

        .main-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 24px;
            margin-bottom: 24px;
        }

        .panel {
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .panel-header {
            padding: 16px 20px;
            border-bottom: 1px solid #e2e8f0;
            font-weight: 600;
            font-size: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .panel-body { padding: 20px; }

        .btn-group {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }

        .btn {
            padding: 10px 20px;
            border-radius: 6px;
            border: none;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #edf2f7;
            color: #2d3748;
        }

        .btn-secondary:hover { background: #e2e8f0; }

        .btn-success {
            background: #c6f6d5;
            color: #22543d;
        }

        .btn-success:hover { background: #9ae6b4; }

        .btn-danger {
            background: #fff5f5;
            color: #e53e3e;
            border: 1px solid #feb2b2;
        }

        .btn-danger:hover { background: #fed7d7; }

        .btn-warning {
            background: #fef5e7;
            color: #c05621;
        }

        .btn-warning:hover { background: #feebc8; }

        .list-empty {
            text-align: center;
            padding: 40px 20px;
            color: #a0aec0;
            font-size: 14px;
        }

        .list-item {
            padding: 16px;
            border-bottom: 1px solid #e2e8f0;
            transition: background 0.2s;
        }

        .list-item:hover { background: #f7fafc; }
        .list-item:last-child { border-bottom: none; }

        .list-item-title {
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 8px;
        }

        .list-item-meta {
            font-size: 13px;
            color: #718096;
        }

        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .badge-info {
            background: #bee3f8;
            color: #2c5282;
        }

        .badge-success {
            background: #c6f6d5;
            color: #22543d;
        }

        .badge-danger {
            background: #fed7d7;
            color: #742a2a;
        }

        .badge-warning {
            background: #feebc8;
            color: #7c2d12;
        }

        .terminal {
            background: #1a202c;
            border-radius: 8px;
            overflow: hidden;
        }

        .terminal-header {
            background: #2d3748;
            padding: 12px 16px;
            display: flex;
            justify-content: space-between;
            color: #e2e8f0;
            font-size: 13px;
            font-weight: 600;
        }

        .terminal-body {
            padding: 16px;
            height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.6;
        }

        .terminal-line {
            margin-bottom: 4px;
            color: #e2e8f0;
        }

        .terminal-line.success { color: #68d391; }
        .terminal-line.error { color: #fc8181; }
        .terminal-line.warning { color: #f6ad55; }
        .terminal-line.info { color: #63b3ed; }
        .terminal-time { color: #a0aec0; margin-right: 8px; }

        .toast {
            position: fixed;
            top: 80px;
            right: 24px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            padding: 16px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            min-width: 300px;
            transform: translateX(400px);
            transition: transform 0.3s ease;
            z-index: 1000;
        }

        .toast.show { transform: translateX(0); }

        .toast-icon {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .toast.success .toast-icon {
            background: #c6f6d5;
            color: #22543d;
        }

        .toast.error .toast-icon {
            background: #fed7d7;
            color: #742a2a;
        }

        .toast-message {
            flex: 1;
            font-size: 14px;
        }

        .info-grid {
            display: grid;
            gap: 12px;
            font-size: 14px;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #f7fafc;
        }

        .info-row:last-child { border-bottom: none; }

        .info-label {
            color: #718096;
            font-weight: 500;
        }

        .info-value {
            color: #2d3748;
            font-weight: 600;
        }

        .quick-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .adapter-card {
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 16px;
            transition: all 0.2s;
        }

        .adapter-card:hover {
            border-color: #667eea;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.2);
        }

        .adapter-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .adapter-name {
            font-weight: 600;
            font-size: 15px;
            color: #2d3748;
        }

        .adapter-info {
            font-size: 13px;
            color: #718096;
            margin-bottom: 4px;
        }

        @media (max-width: 1024px) {
            .main-grid { grid-template-columns: 1fr; }
        }

        @media (max-width: 768px) {
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
            .quick-grid { grid-template-columns: 1fr; }
            .nav-tabs { overflow-x: auto; }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-top">
            <div class="header-content">
                <div class="header-left">
                    <h1>üçì RaspPunzel</h1>
                </div>
                <div class="header-right">
                    <div class="user-menu">
                        <div class="user-button" onclick="toggleUserMenu()">
                            <div class="user-avatar">A</div>
                            <span>Admin</span>
                            <span>‚ñº</span>
                        </div>
                        <div class="dropdown-menu" id="userDropdown">
                            <div class="dropdown-item" onclick="reloadPage()">üîÑ Actualiser</div>
                            <div class="dropdown-item danger" onclick="logout()">üö™ D√©connexion</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('ligolo')">
                <span>üîó</span> Ligolo-ng
            </button>
            <button class="nav-tab" onclick="switchTab('wifi-ap')">
                <span>üì°</span> WiFi Access Point
            </button>
            <button class="nav-tab" onclick="switchTab('pentest')">
                <span>üéØ</span> Pentest Adapters
            </button>
        </div>
    </div>

    <div class="container">
        <!-- TAB LIGOLO -->
        <div id="tab-ligolo" class="tab-content active">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">Agent Ligolo</div>
                    <div class="stat-value" id="agentStatus">--</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Connexion Proxy</div>
                    <div class="stat-value" id="proxyConnection">--</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Routes Actives</div>
                    <div class="stat-value" id="routesCount">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Uptime</div>
                    <div class="stat-value" id="uptime">--</div>
                </div>
            </div>

            <div class="main-grid">
                <div>
                    <div class="panel" style="margin-bottom: 24px;">
                        <div class="panel-header">Contr√¥le Ligolo-ng</div>
                        <div class="panel-body">
                            <div class="btn-group">
                                <button class="btn btn-success" onclick="startLigolo()">‚ñ∂Ô∏è D√©marrer</button>
                                <button class="btn btn-secondary" onclick="restartLigolo()">üîÑ Red√©marrer</button>
                                <button class="btn btn-danger" onclick="stopLigolo()">‚èπÔ∏è Arr√™ter</button>
                            </div>
                        </div>
                    </div>

                    <div class="panel">
                        <div class="panel-header">
                            <span>Routes r√©seau</span>
                            <button class="btn btn-secondary" onclick="refreshRoutes()" style="padding: 6px 12px; font-size: 12px;">üîÑ</button>
                        </div>
                        <div id="routesList">
                            <div class="list-empty">Chargement des routes...</div>
                        </div>
                    </div>
                </div>

                <div>
                    <div class="panel" style="margin-bottom: 24px;">
                        <div class="panel-header">Actions rapides</div>
                        <div class="panel-body">
                            <div class="quick-grid">
                                <button class="btn btn-secondary" onclick="showLogs()">üìã Logs</button>
                                <button class="btn btn-secondary" onclick="showNetworkInfo()">üåê R√©seau</button>
                                <button class="btn btn-secondary" onclick="exportConfig()">üíæ Export</button>
                                <button class="btn btn-secondary" onclick="refreshRoutes()">üîÑ Routes</button>
                            </div>
                        </div>
                    </div>

                    <div class="panel">
                        <div class="panel-header">Configuration Ligolo</div>
                        <div class="panel-body">
                            <div class="info-grid">
                                <div class="info-row">
                                    <span class="info-label">Proxy Host</span>
                                    <span class="info-value" id="proxyHost">--</span>
                                </div>
                                <div class="info-row">
                                    <span class="info-label">Proxy Port</span>
                                    <span class="info-value" id="proxyPort">--</span>
                                </div>
                                <div class="info-row">
                                    <span class="info-label">Version</span>
                                    <span class="info-value" id="ligoloVersion">--</span>
                                </div>
                                <div class="info-row">
                                    <span class="info-label">PID</span>
                                    <span class="info-value" id="ligoloPid">--</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB WIFI AP -->
        <div id="tab-wifi-ap" class="tab-content">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">Hostapd</div>
                    <div class="stat-value" id="hostapdStatus">--</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">DNSMasq</div>
                    <div class="stat-value" id="dnsmasqStatus">--</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Clients Connect√©s</div>
                    <div class="stat-value" id="clientsCount">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Interface AP</div>
                    <div class="stat-value" id="apInterface" style="font-size: 18px;">--</div>
                </div>
            </div>

            <div class="main-grid">
                <div>
                    <div class="panel" style="margin-bottom: 24px;">
                        <div class="panel-header">Contr√¥le Access Point</div>
                        <div class="panel-body">
                            <div class="btn-group">
                                <button class="btn btn-success" onclick="startAP()">‚ñ∂Ô∏è D√©marrer AP</button>
                                <button class="btn btn-secondary" onclick="restartAP()">üîÑ Red√©marrer</button>
                                <button class="btn btn-danger" onclick="stopAP()">‚èπÔ∏è Arr√™ter AP</button>
                            </div>
                        </div>
                    </div>

                    <div class="panel">
                        <div class="panel-header">Clients connect√©s</div>
                        <div id="clientsList">
                            <div class="list-empty">Aucun client connect√©</div>
                        </div>
                    </div>
                </div>

                <div>
                    <div class="panel">
                        <div class="panel-header">Configuration AP</div>
                        <div class="panel-body">
                            <div class="info-grid">
                                <div class="info-row">
                                    <span class="info-label">SSID</span>
                                    <span class="info-value">PWNBOX_ADMIN</span>
                                </div>
                                <div class="info-row">
                                    <span class="info-label">IP Gateway</span>
                                    <span class="info-value">10.0.0.1</span>
                                </div>
                                <div class="info-row">
                                    <span class="info-label">DHCP Range</span>
                                    <span class="info-value">10.0.0.2-30</span>
                                </div>
                                <div class="info-row">
                                    <span class="info-label">Canal</span>
                                    <span class="info-value">11</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB PENTEST -->
        <div id="tab-pentest" class="tab-content">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">Adapters D√©tect√©s</div>
                    <div class="stat-value" id="adaptersCount">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Mode Monitor</div>
                    <div class="stat-value" id="monitorModeCount">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">CPU</div>
                    <div class="stat-value" id="cpuUsage">--%</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">M√©moire</div>
                    <div class="stat-value" id="memoryUsage">--%</div>
                </div>
            </div>

            <div class="main-grid">
                <div>
                    <div class="panel">
                        <div class="panel-header">
                            <span>Adapters WiFi</span>
                            <button class="btn btn-secondary" onclick="refreshAdapters()" style="padding: 6px 12px; font-size: 12px;">üîÑ</button>
                        </div>
                        <div class="panel-body">
                            <div id="adaptersList">
                                <div class="list-empty">Chargement des adapters...</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div>
                    <div class="panel" style="margin-bottom: 24px;">
                        <div class="panel-header">Actions rapides</div>
                        <div class="panel-body">
                            <div class="quick-grid">
                                <button class="btn btn-secondary" onclick="showLogs()">üìã Logs</button>
                                <button class="btn btn-secondary" onclick="showNetworkInfo()">üåê R√©seau</button>
                                <button class="btn btn-secondary" onclick="exportConfig()">üíæ Export</button>
                                <button class="btn btn-warning" onclick="scanNetworks()">üì° Scan</button>
                            </div>
                        </div>
                    </div>

                    <div class="panel">
                        <div class="panel-header">Informations syst√®me</div>
                        <div class="panel-body">
                            <div class="info-grid">
                                <div class="info-row">
                                    <span class="info-label">Hostname</span>
                                    <span class="info-value" id="hostname">--</span>
                                </div>
                                <div class="info-row">
                                    <span class="info-label">Adresse IP</span>
                                    <span class="info-value" id="ipAddress">--</span>
                                </div>
                                <div class="info-row">
                                    <span class="info-label">Kernel</span>
                                    <span class="info-value" id="kernelVersion">--</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TERMINAL (commun √† tous les onglets) -->
        <div class="terminal">
            <div class="terminal-header">
                <span>Terminal</span>
                <button class="btn btn-secondary" onclick="clearTerminal()" style="padding: 4px 12px; font-size: 12px;">Effacer</button>
            </div>
            <div class="terminal-body" id="terminal">
                <div class="terminal-line info">RaspPunzel Dashboard v2.1 - Multi-sections</div>
                <div class="terminal-line">Connexion au serveur...</div>
            </div>
        </div>
    </div>

    <div class="toast" id="toast">
        <div class="toast-icon">‚úì</div>
        <div class="toast-message" id="toastMessage"></div>
    </div>

    <script>
        const API_BASE = window.location.origin;
        let socket;
        let currentTab = 'ligolo';

        // Navigation entre onglets
        function switchTab(tabName) {
            currentTab = tabName;
            
            // Masquer tous les onglets
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // D√©sactiver tous les boutons
            document.querySelectorAll('.nav-tab').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Activer l'onglet s√©lectionn√©
            document.getElementById(`tab-${tabName}`).classList.add('active');
            event.target.closest('.nav-tab').classList.add('active');
            
            addToTerminal(`Navigation vers: ${tabName}`, 'info');
            
            // Charger les donn√©es sp√©cifiques √† l'onglet
            loadTabData(tabName);
        }

        function toggleUserMenu() {
            document.getElementById('userDropdown').classList.toggle('show');
        }

        document.addEventListener('click', (e) => {
            if (!e.target.closest('.user-menu')) {
                document.getElementById('userDropdown').classList.remove('show');
            }
        });

        function logout() {
            window.location.href = '/logout';
        }

        function reloadPage() {
            window.location.reload();
        }

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');
            toast.className = `toast ${type}`;
            toastMessage.textContent = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        function addToTerminal(text, type = '') {
            const terminal = document.getElementById('terminal');
            const line = document.createElement('div');
            line.className = `terminal-line ${type}`;
            const time = new Date().toLocaleTimeString();
            line.innerHTML = `<span class="terminal-time">${time}</span>${text}`;
            terminal.appendChild(line);
            terminal.scrollTop = terminal.scrollHeight;
            while (terminal.children.length > 100) {
                terminal.removeChild(terminal.firstChild);
            }
        }

        function clearTerminal() {
            document.getElementById('terminal').innerHTML = '<div class="terminal-line info">Terminal effac√©</div>';
        }

        function initializeSocket() {
            socket = io(API_BASE);
            socket.on('connect', () => {
                addToTerminal('‚úì WebSocket connect√©', 'success');
                loadSystemStatus();
            });
            socket.on('disconnect', () => {
                addToTerminal('‚úó WebSocket d√©connect√©', 'warning');
            });
            socket.on('terminal_output', (data) => {
                addToTerminal(data.output, 'info');
            });
        }

        async function loadSystemStatus() {
            try {
                const response = await fetch(`${API_BASE}/api/status`);
                const data = await response.json();
                
                if (data.success) {
                    // Stats communes
                    document.getElementById('cpuUsage').textContent = `${Math.round(data.system.cpu_percent)}%`;
                    document.getElementById('memoryUsage').textContent = `${Math.round(data.system.memory_percent)}%`;
                    document.getElementById('uptime').textContent = data.system.uptime || '--';
                    document.getElementById('hostname').textContent = data.system.hostname || '--';
                    
                    // Ligolo
                    const agentStatus = document.getElementById('agentStatus');
                    if (data.services && data.services['ligolo-agent']) {
                        agentStatus.textContent = 'ACTIF';
                        agentStatus.classList.add('online');
                        agentStatus.classList.remove('offline');
                    } else {
                        agentStatus.textContent = 'INACTIF';
                        agentStatus.classList.add('offline');
                        agentStatus.classList.remove('online');
                    }
                    
                    // WiFi AP
                    updateAPStatus(data.services);
                    
                    // Connexion proxy
                    if (data.ligolo && data.ligolo.connection && data.ligolo.connection.connected) {
                        document.getElementById('proxyConnection').textContent = 'CONNECT√â';
                        document.getElementById('proxyConnection').classList.add('online');
                    } else {
                        document.getElementById('proxyConnection').textContent = 'D√âCONNECT√â';
                        document.getElementById('proxyConnection').classList.add('offline');
                    }
                    
                    if (data.ligolo) {
                        document.getElementById('proxyHost').textContent = data.ligolo.proxy_host || 'Non configur√©';
                        document.getElementById('proxyPort').textContent = data.ligolo.proxy_port || '--';
                        document.getElementById('ligoloVersion').textContent = data.ligolo.version || '--';
                        document.getElementById('ligoloPid').textContent = data.ligolo.pid || '--';
                    }
                    
                    if (data.system.network_interfaces) {
                        const interfaces = Object.values(data.system.network_interfaces);
                        const firstInterface = interfaces.find(i => i.ip && i.ip !== '127.0.0.1');
                        document.getElementById('ipAddress').textContent = firstInterface?.ip || '--';
                    }
                    
                    // Routes
                    document.getElementById('routesCount').textContent = data.routes_count || 0;
                    updateRoutes(data.routes);
                    
                    // Adapters
                    loadAdapters();
                }
            } catch (error) {
                addToTerminal(`Erreur: ${error.message}`, 'error');
            }
        }

        function updateAPStatus(services) {
            const hostapdStatus = document.getElementById('hostapdStatus');
            const dnsmasqStatus = document.getElementById('dnsmasqStatus');
            
            if (services && services.hostapd) {
                hostapdStatus.textContent = 'ACTIF';
                hostapdStatus.classList.add('online');
                hostapdStatus.classList.remove('offline');
            } else {
                hostapdStatus.textContent = 'INACTIF';
                hostapdStatus.classList.add('offline');
                hostapdStatus.classList.remove('online');
            }
            
            if (services && services.dnsmasq) {
                dnsmasqStatus.textContent = 'ACTIF';
                dnsmasqStatus.classList.add('online');
                dnsmasqStatus.classList.remove('offline');
            } else {
                dnsmasqStatus.textContent = 'INACTIF';
                dnsmasqStatus.classList.add('offline');
                dnsmasqStatus.classList.remove('online');
            }
        }

        function loadTabData(tabName) {
            switch(tabName) {
                case 'ligolo':
                    refreshRoutes();
                    break;
                case 'wifi-ap':
                    loadAPClients();
                    break;
                case 'pentest':
                    loadAdapters();
                    break;
            }
        }

        function updateRoutes(routes) {
            const routesList = document.getElementById('routesList');
            
            if (!routes || !Array.isArray(routes) || routes.length === 0) {
                routesList.innerHTML = '<div class="list-empty">Aucune route configur√©e<br><small style="margin-top: 8px; display: block;">V√©rifiez que l\'agent Ligolo est actif et connect√©</small></div>';
                return;
            }
            
            routesList.innerHTML = routes.map((route, index) => {
                const destination = route.destination || route.network || route.subnet || 'N/A';
                const interfaceName = route.interface || route.dev || route.iface || 'N/A';
                const gateway = route.gateway || route.via || route.gw || 'N/A';
                const type = route.type || 'unknown';
                
                let badgeClass = 'badge-info';
                if (type === 'ligolo') badgeClass = 'badge-success';
                else if (type === 'default') badgeClass = 'badge-warning';
                
                return `
                    <div class="list-item">
                        <div class="list-item-title">
                            üåê ${destination}
                            <span class="badge ${badgeClass}">${type}</span>
                        </div>
                        <div class="list-item-meta">
                            Interface: <strong>${interfaceName}</strong>
                            ${gateway !== 'N/A' ? ` | Gateway: <strong>${gateway}</strong>` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        async function loadAdapters() {
            try {
                const response = await fetch(`${API_BASE}/api/network/info`);
                const data = await response.json();
                
                if (data.success && data.interfaces) {
                    const wifiInterfaces = Object.entries(data.interfaces).filter(([name, info]) => 
                        name.startsWith('wlan') || name.startsWith('wlx')
                    );
                    
                    document.getElementById('adaptersCount').textContent = wifiInterfaces.length;
                    
                    const adaptersList = document.getElementById('adaptersList');
                    
                    if (wifiInterfaces.length === 0) {
                        adaptersList.innerHTML = '<div class="list-empty">Aucun adapter WiFi d√©tect√©</div>';
                        return;
                    }
                    
                    adaptersList.innerHTML = wifiInterfaces.map(([name, info]) => {
                        let ip = 'N/A';
                        let status = 'down';
                        
                        if (info.addresses && info.addresses.length > 0) {
                            const ipv4 = info.addresses.find(addr => addr.type === 'ipv4');
                            if (ipv4 && ipv4.ip) ip = ipv4.ip;
                        } else if (info.ip) {
                            ip = info.ip;
                        }
                        
                        if (info.status) status = info.status;
                        
                        const statusBadge = status === 'up' ? 'badge-success' : 'badge-danger';
                        
                        return `
                            <div class="adapter-card">
                                <div class="adapter-header">
                                    <span class="adapter-name">${name}</span>
                                    <span class="badge ${statusBadge}">${status.toUpperCase()}</span>
                                </div>
                                <div class="adapter-info">IP: ${ip}</div>
                                <div class="adapter-info">Netmask: ${info.netmask || 'N/A'}</div>
                                <div style="margin-top: 12px;">
                                    <button class="btn btn-secondary" style="padding: 6px 12px; font-size: 12px; margin-right: 8px;" onclick="toggleMonitorMode('${name}')">
                                        üéØ Monitor
                                    </button>
                                    <button class="btn btn-secondary" style="padding: 6px 12px; font-size: 12px;" onclick="toggleInterface('${name}')">
                                        ${status === 'up' ? '‚èπÔ∏è Down' : '‚ñ∂Ô∏è Up'}
                                    </button>
                                </div>
                            </div>
                        `;
                    }).join('');
                }
            } catch (error) {
                addToTerminal(`Erreur chargement adapters: ${error.message}`, 'error');
            }
        }

        async function loadAPClients() {
            // Simuler pour le moment - √† impl√©menter c√¥t√© backend
            const clientsList = document.getElementById('clientsList');
            clientsList.innerHTML = '<div class="list-empty">Aucun client connect√©</div>';
            document.getElementById('clientsCount').textContent = '0';
        }

        async function refreshRoutes() {
            try {
                addToTerminal('Actualisation des routes...', 'info');
                const response = await fetch(`${API_BASE}/api/routes`);
                const data = await response.json();
                
                if (data.success) {
                    updateRoutes(data.routes);
                    showToast('Routes actualis√©es');
                    addToTerminal(`‚úì ${data.routes ? data.routes.length : 0} route(s) r√©cup√©r√©e(s)`, 'success');
                } else {
                    addToTerminal('‚úó Erreur lors de la r√©cup√©ration des routes', 'error');
                }
            } catch (error) {
                addToTerminal(`Erreur: ${error.message}`, 'error');
            }
        }

        async function refreshAdapters() {
            addToTerminal('Actualisation des adapters WiFi...', 'info');
            await loadAdapters();
            showToast('Adapters actualis√©s');
        }

        // Ligolo Controls
        async function startLigolo() {
            try {
                addToTerminal('D√©marrage Ligolo...', 'info');
                const response = await fetch(`${API_BASE}/api/services/start`, { 
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({services: ['ligolo-agent']})
                });
                const data = await response.json();
                if (data.success) {
                    addToTerminal('‚úì Ligolo d√©marr√©', 'success');
                    showToast('Ligolo d√©marr√©');
                    setTimeout(loadSystemStatus, 2000);
                }
            } catch (error) {
                addToTerminal(`Erreur: ${error.message}`, 'error');
            }
        }

        async function stopLigolo() {
            if (!confirm('Arr√™ter l\'agent Ligolo ?')) return;
            try {
                addToTerminal('Arr√™t Ligolo...', 'warning');
                const response = await fetch(`${API_BASE}/api/services/stop`, { 
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({services: ['ligolo-agent']})
                });
                const data = await response.json();
                if (data.success) {
                    addToTerminal('‚úì Ligolo arr√™t√©', 'warning');
                    showToast('Ligolo arr√™t√©', 'warning');
                    setTimeout(loadSystemStatus, 2000);
                }
            } catch (error) {
                addToTerminal(`Erreur: ${error.message}`, 'error');
            }
        }

        async function restartLigolo() {
            try {
                addToTerminal('Red√©marrage Ligolo...', 'info');
                const response = await fetch(`${API_BASE}/api/ligolo/restart`, { method: 'POST' });
                const data = await response.json();
                if (data.success) {
                    addToTerminal('‚úì Ligolo red√©marr√©', 'success');
                    showToast('Ligolo red√©marr√©');
                    setTimeout(loadSystemStatus, 2000);
                }
            } catch (error) {
                addToTerminal(`Erreur: ${error.message}`, 'error');
            }
        }

        // WiFi AP Controls
        async function startAP() {
            try {
                addToTerminal('D√©marrage Access Point...', 'info');
                const response = await fetch(`${API_BASE}/api/services/start`, { 
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({services: ['hostapd', 'dnsmasq']})
                });
                const data = await response.json();
                if (data.success) {
                    addToTerminal('‚úì Access Point d√©marr√©', 'success');
                    showToast('Access Point d√©marr√©');
                    setTimeout(loadSystemStatus, 2000);
                }
            } catch (error) {
                addToTerminal(`Erreur: ${error.message}`, 'error');
            }
        }

        async function stopAP() {
            if (!confirm('Arr√™ter l\'Access Point ?')) return;
            try {
                addToTerminal('Arr√™t Access Point...', 'warning');
                const response = await fetch(`${API_BASE}/api/services/stop`, { 
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({services: ['hostapd', 'dnsmasq']})
                });
                const data = await response.json();
                if (data.success) {
                    addToTerminal('‚úì Access Point arr√™t√©', 'warning');
                    showToast('Access Point arr√™t√©', 'warning');
                    setTimeout(loadSystemStatus, 2000);
                }
            } catch (error) {
                addToTerminal(`Erreur: ${error.message}`, 'error');
            }
        }

        async function restartAP() {
            try {
                addToTerminal('Red√©marrage Access Point...', 'info');
                const response = await fetch(`${API_BASE}/api/services/restart`, { 
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({services: ['hostapd', 'dnsmasq']})
                });
                const data = await response.json();
                if (data.success) {
                    addToTerminal('‚úì Access Point red√©marr√©', 'success');
                    showToast('Access Point red√©marr√©');
                    setTimeout(loadSystemStatus, 3000);
                }
            } catch (error) {
                addToTerminal(`Erreur: ${error.message}`, 'error');
            }
        }

        // Pentest Adapter Controls
        async function toggleMonitorMode(interfaceName) {
            addToTerminal(`Mode monitor pour ${interfaceName} - Fonctionnalit√© √† impl√©menter`, 'warning');
            showToast('Fonctionnalit√© en d√©veloppement', 'warning');
        }

        async function toggleInterface(interfaceName) {
            addToTerminal(`Toggle interface ${interfaceName} - Fonctionnalit√© √† impl√©menter`, 'warning');
            showToast('Fonctionnalit√© en d√©veloppement', 'warning');
        }

        async function scanNetworks() {
            addToTerminal('Scan des r√©seaux WiFi - Fonctionnalit√© √† impl√©menter', 'warning');
            showToast('Fonctionnalit√© en d√©veloppement', 'warning');
        }

        // Utility functions
        async function showLogs() {
            try {
                const response = await fetch(`${API_BASE}/api/logs`);
                const data = await response.json();
                if (data.success && data.logs) {
                    addToTerminal('=== LOGS SYST√àME ===', 'info');
                    const logs = Array.isArray(data.logs) ? data.logs : data.logs.ligolo || [];
                    const recentLogs = logs.slice(-20);
                    if (recentLogs.length === 0) {
                        addToTerminal('Aucun log disponible', 'warning');
                    } else {
                        recentLogs.forEach(log => {
                            if (typeof log === 'object' && log.line) {
                                addToTerminal(log.line, 'info');
                            } else if (typeof log === 'string') {
                                addToTerminal(log, 'info');
                            }
                        });
                    }
                    addToTerminal('=== FIN LOGS ===', 'info');
                } else {
                    addToTerminal('Aucun log disponible', 'warning');
                }
            } catch (error) {
                addToTerminal(`Erreur: ${error.message}`, 'error');
            }
        }

        async function showNetworkInfo() {
            try {
                const response = await fetch(`${API_BASE}/api/network/info`);
                const data = await response.json();
                if (data.success && data.interfaces) {
                    addToTerminal('=== INFORMATIONS R√âSEAU ===', 'info');
                    Object.entries(data.interfaces).forEach(([iface, info]) => {
                        let ip = 'N/A';
                        let status = 'unknown';
                        
                        if (info.addresses && info.addresses.length > 0) {
                            const ipv4 = info.addresses.find(addr => addr.type === 'ipv4');
                            if (ipv4 && ipv4.ip) ip = ipv4.ip;
                        } else if (info.ip) {
                            ip = info.ip;
                        }
                        
                        if (info.status) status = info.status;
                        
                        addToTerminal(`${iface}: ${ip} (${status})`, 'info');
                    });
                    addToTerminal('=== FIN INFO R√âSEAU ===', 'info');
                } else {
                    addToTerminal('Informations r√©seau non disponibles', 'warning');
                }
            } catch (error) {
                addToTerminal(`Erreur: ${error.message}`, 'error');
            }
        }

        async function exportConfig() {
            try {
                const response = await fetch(`${API_BASE}/api/config/export`);
                const data = await response.json();
                if (data.success && data.config) {
                    const blob = new Blob([JSON.stringify(data.config, null, 2)], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `rasppunzel-config-${new Date().toISOString().split('T')[0]}.json`;
                    a.click();
                    URL.revokeObjectURL(url);
                    addToTerminal('‚úì Configuration export√©e', 'success');
                    showToast('Configuration export√©e');
                } else {
                    addToTerminal('‚úó Erreur', 'error');
                }
            } catch (error) {
                addToTerminal(`Erreur: ${error.message}`, 'error');
            }
        }

        // Initialisation
        document.addEventListener('DOMContentLoaded', () => {
            initializeSocket();
            setInterval(loadSystemStatus, 30000);
        });

        // Raccourcis clavier
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.key === 'l') {
                e.preventDefault();
                clearTerminal();
            }
            if (e.ctrlKey && e.key === 'r') {
                e.preventDefault();
                loadSystemStatus();
            }
        });
    </script>
</body>
</html>